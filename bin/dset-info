#!/usr/bin/env python2
# encoding: utf-8
"""
Print information about a dset file.
"""

from __future__ import division, print_function

import sys
import pypb.dset

OKEYS = ["length", "block_length", "serializer", "compression"]

def main():
    if len(sys.argv) < 2:
        print("Usage: dset-info <fname.dset>...")
        sys.exit(1)

    for fname in sys.argv[1:]:
        with pypb.dset.open(fname) as dset:
            print(fname)

            msg = "    version: {}"
            msg = msg.format(dset.version)
            print(msg)

            keys = set(dset.header.keys()) - set(OKEYS)
            keys = sorted(keys)
            keys = OKEYS + keys
            for k in keys:
                v = dset.header[k]

                if isinstance(v, (int, long)):
                    msg = "    {}: {:,d}"
                else:
                    msg = "    {}: {}"
                msg = msg.format(k, v)
                print(msg)

            msg = "    len(index): {:,d}"
            msg = msg.format(len(dset.index))
            print(msg)

            if dset.index:
                msg = "    avg(block_size): {:,.2f}"
                msg = msg.format(sum(x[1] for x in dset.index) / len(dset.index))
                print(msg)

                msg = "    avg(block_size_raw): {:,.2f}"
                msg = msg.format(sum(x[2] for x in dset.index) / len(dset.index))
                print(msg)

if __name__ == '__main__':
    main()
